<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatiable" content=" ie-edge">
  <title>ETHONOMOUSPAY</title>
  <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>

  <!-- <script src="./web3.min.js"></script> -->

  <script src="https://wzrd.in/standalone/buffer"></script>
  <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
  <script src="https://unpkg.com/ipfs-api@9.0.0/dist/index.js"
  integrity="sha384-5bXRcW9kyxxnSMbOoHzraqa7Z0PQWIao+cgeg327zit1hz5LZCEbIMx/LWKPReuB"
  crossorigin="anonymous"></script>
  <script src="https://canvasjs.com/assets/script/jquery-1.11.1.min.js"></script>
<script src="https://canvasjs.com/assets/script/jquery.canvasjs.min.js"></script>

  <link rel="stylesheet" type="text/css" href="./stylesheets/multisig.css">
  <link rel="stylesheet" type="text/css" href="./stylesheets/app.css">
</head>
<body>
  <table style="width: 100%;">
    <tr>
      <td class="tableFormat">
        <form>
          <table style="width: 100%;">
            <tr>
              <td style="text-align: center" colspan="2">
                <p style="font-size: 30px;"> PURCHASE DETAILS</p>
                <br>
              </td>
            </tr>
            <tr>
              <td>
                <label for="IP_CarVIN"><font face="garamond">Enter VIN Details</font></label>
              </td>
              <td>
                <input id="IP_CarVIN" label = "Enter VIN Details" type="text" class="textBoxFormat">
              </td>
            </tr>
            <tr height="30"><td></td></tr>
            <tr>
              <td>
                <label for="IP_CarPurchaseInvoice">Purchase Invoice</label>
              </td>
              <td>
                <!-- <input id="IP_CarPurchaseInvoice" label = "Purchase Invoice" type="file" class="textBoxFormat"> -->
                <input type="file" name="photo" id="IP_CarPurchaseInvoice" class="contextfile">
              </td>
            </tr>
            <tr>
              <td style="text-align: center" colspan="2">
                <br>
                <!-- <button id="BT_CreateContract" class="buttonFormat">Create Contract</button> -->
                <!-- <button type="button" onclick="upload_CarPurchaseInvoice()">Upload</button> -->
                <hr>
                <input type="button" class="buttonFormat" value="SUBMIT DETAILS" onclick="upload_CarPurchaseInvoice()"></button>
              </td>
            </tr>
          </table>
        </form>
      </td>
      <td style="vertical-align: top;" class="tableFormat">
        <form>
          <table style="width: 100%;">
            <tr>
              <td style="text-align: center" colspan="2">
              <p style="font-size: 30px;"> SERVICE DETAILS </p>
              </td>
            </tr>
            <tr>
              <td>
                <label for="IP_ServiceAmount">Invoice Amount</label>
              </td>
              <td>
                <input id="IP_ServiceAmount" label = "Inoice Amount" type="text" class="textBoxFormat">
              </td>
            </tr>
            <tr height="10"><td></td></tr>
            <tr>
              <td>
                <label for="IP_ServiceInvoiceDate">Date</label>
              </td>
              <td>
                <input id="IP_ServiceInvoiceDate"  type="date" class="textBoxFormat">
              </td>
            </tr>
            <tr height="10"><td></td></tr>
            <tr>
              <td>
                <label for="IP_ServiceInvoice">Service Invoice</label>
              </td>
              <td>
                <!-- <input id="IP_ServiceInvoice" label = "Service Invoice No" type="file" class="textBoxFormat"> -->
                <input type="file" name="photo" id="IP_ServiceInvoice" class="textBoxFormat">
              </td>
            </tr>
            <tr height="10"><td></td></tr>
            <tr>
              <td style="text-align: center" colspan="2">
                <!-- <button id="BT_Submit" style="float: right;" class="buttonFormat">Upload</button> -->
                <!-- <button type="button" onclick="upload_ServiceInvoice()">Upload</button> -->
                <hr>
                <input type="button" class="buttonFormat" value="SUBMIT DETAILS" onclick="upload_ServiceInvoice()"></button>
              </td>
            </tr>
      </table>
    </form>
  </td>
</tr>
<tr>
  <td class="tableFormat">
    <form>
      <table style="width: 100%;">
        <tr>
          <td style="text-align: center" colspan="2">
          <p style="font-size: 30px;"> CLAIM DETAILS</p>
            <br>
          </td>
        </tr>
        <tr>
          <td>
            <label for="IP_InsuranceClaimNumber">Claim Number</label>
          </td>
          <td>
            <input id="IP_InsuranceClaimNumber"  type="text" class="textBoxFormat">
          </td>
        </tr>
        <tr>
          <td >
            <br>
            <label for="IP_InsuranceClaimAmount">Claim Amount</label>
          </td>
          <td >
            <br>
            <input name="IP_InsuranceClaimAmount" id="IP_InsuranceClaimAmount" type="text" class="textBoxFormat">
          </td>
        </tr>
        <tr>
          <td >
            <br>
            <label for="IP_InsuranceClaimDate">Claim Value</label>
          </td>
          <td >
            <br>
            <input name="IP_InsuranceClaimDate" id="IP_InsuranceClaimDate" type="date" class="textBoxFormat">
          </td>
        </tr>
        <tr height="20"><td></td></tr>
        <tr>
          <td>
            <label for="IP_ClaimInvoice">Claim Invoice</label>
          </td>
          <td>
            <!-- <input id="IP_ClaimInvoice" label = "IP_ClaimInvoice" type="file" class="textBoxFormat"> -->
            <input type="file" name="photo" id="IP_ClaimInvoice" class="textBoxFormat">
          </td>
        </tr>
        <tr>
          <td style="text-align: center" colspan="2">
            <br>
          </td>
        </tr>
        <tr>
          <td colspan="2"  style="text-align: center;">
            <!-- <button id="BT_ClaimUpload" class="buttonFormat" class="buttonFormat">Claim Upload</button> -->
            <!-- <button type="button" onclick="upload_ClaimInvoice()">Upload</button> -->
            <hr>
              <input type="button" class="buttonFormat" value="SUBMIT DETAILS" onclick="upload_ClaimInvoice()"></button>
              <hr>
              <p style="font-size: 30px;"> INSURANCE DETAILS </p>
          </td>
        </tr>
        <tr height="20"><td></td></tr>
        <tr>
          <td>
            <label for="IP_InsuranceIssueNumber">Insurance Number</label>
          </td>
          <td>
            <input id="IP_InsuranceIssueNumber"  type="text" class="textBoxFormat">
          </td>
        </tr>
        <tr>
          <td >
            <br>
            <label for="IP_InsurancePremiumAmount">Premium Amount</label>
          </td>
          <td >
            <br>
            <input name="IP_InsurancePremiumAmount" id="IP_InsurancePremiumAmount" type="text" class="textBoxFormat">
          </td>
        </tr>
        <tr>
          <td >
            <br>
            <label for="IP_InsuranceIssueDate">Issue Date</label>
          </td>
          <td >
            <br>
            <input name="IP_InsuranceIssueDate" id="IP_InsuranceIssueDate" type="date" class="textBoxFormat">
          </td>
        </tr>
        <tr height="20"><td></td></tr>
        <tr>
          <td>
            <label for="IP_InsuranceIssueInvoice">Issue Invoice</label>
          </td>
          <td>
            <!-- <input id="IP_InsuranceIssueInvoice" label = "IP_InsuranceIssueInvoice" type="file" class="textBoxFormat"> -->
            <input type="file" name="photo" id="IP_InsuranceIssueInvoice" class="textBoxFormat">
          </td>
        </tr>
        <tr>
          <td style="text-align: center" colspan="2">
            <br>
          </td>
        </tr>
        <tr>
          <td colspan="2"  style="text-align: center;">
            <!-- <button id="BT_ClaimUpload" class="buttonFormat" class="buttonFormat">Issue Upload</button> -->
            <!-- <button type="button" onclick="upload_InsuranceIssueInvoice()">Upload</button> -->
            <hr>
              <input type="button" class="buttonFormat" value="SUBMIT DETAILS" onclick="upload_InsuranceIssueInvoice()"></button>
          </td>
        </tr>
        <tr>
          <td style="text-align: center" colspan="2">
            <br>
          </td>
        </tr>
      <tr>
            <td style="text-align: center" colspan="2">
              <br>
            </td>
          </tr>
        </table>
      </form>
    </td>
    <td style="vertical-align: top;" class="tableFormat">
      <form>
        <table style="width: 100%;">
          <tr>
            <td style="text-align: center" colspan="2">
              <br>
            </td>
          </tr>
          <tr>
            <br>
            <input type="button" id="BT_OpenBeneficiaries"  style="width: 30%;" class="buttonFormat" value="Check Reports"></input>
          </tr>
          <tr>
              <td colspan="2">
        <div id="chartContainer" style="height: 300px; width: 100%; hidden"></div>
        <div id="serviceContainer" style="height: 300px; width: 100%; hidden"></div>
    </td>
          </tr>

          <tr>
            <td style="text-align: center" colspan="2">
              <br>
            </td>
          </tr>
        </table>
      </form>
    </td>
  </tr>
</table>
<script>
var options = {
	exportEnabled: true,
	animationEnabled: true,
	title:{
		text: "ODOMETER READINGS"
	},
	subtitles: [{
		text: ""
	}],
	axisX: {
		title: "TIME"
	},
	axisY: {
		title: "KM COVERED",
		titleFontColor: "#4F81BC",
		lineColor: "#4F81BC",
		labelFontColor: "#4F81BC",
		tickColor: "#4F81BC",
		includeZero: false
	},
	//axisY2: {
	//	title: "Profit in USD",
	//	titleFontColor: "#C0504E",
	//	lineColor: "#C0504E",
	//	labelFontColor: "#C0504E",
	//	tickColor: "#C0504E",
	//	includeZero: false
	//},
	toolTip: {
		shared: true
	},
	legend: {
		cursor: "pointer",
		itemclick: toggleDataSeries
	},
	data: [{
		type: "spline",
		name: "KM Covered",
		showInLegend: true,
		xValueFormatString: "MMM YYYY",
		yValueFormatString: "#,##0 KMs",
		dataPoints: [
			{ x: new Date(2017, 5, 1),  y: 1200 },
			{ x: new Date(2017, 6, 1), y: 2400 },
			{ x: new Date(2017, 7, 1), y: 3800 },
			{ x: new Date(2017, 8, 1), y: 5200 },
			{ x: new Date(2017, 9, 1), y: 7000 },
			{ x: new Date(2017, 10, 1), y: 7200 },
			{ x: new Date(2017, 11, 1), y: 10100 },
			{ x: new Date(2017, 12, 1), y: 11000 },
			{ x: new Date(2018, 1, 1), y: 12200 },
			{ x: new Date(2018, 2, 1), y: 14000 },
			{ x: new Date(2018, 3, 1), y: 15500 },
			{ x: new Date(2018, 4, 1), y: 17000 }
		]
	}]
};
window.options = options;

var serviceOptions = {
    exportEnabled: true,
    animationEnabled: true,
    title: {
        text: "SERVICE READINGS"
    },
    subtitles: [{
        text: ""
    }],
    axisX: {
        title: "TIME"
    },
    axisY: {
        title: "SERVICE AMOUNT (RS)",
        titleFontColor: "#4F81BC",
        lineColor: "#4F81BC",
        labelFontColor: "#4F81BC",
        tickColor: "#4F81BC",
        includeZero: false
    },
    //axisY2: {
    //	title: "Profit in USD",
    //	titleFontColor: "#C0504E",
    //	lineColor: "#C0504E",
    //	labelFontColor: "#C0504E",
    //	tickColor: "#C0504E",
    //	includeZero: false
    //},
    toolTip: {
        shared: true
    },
    legend: {
        cursor: "pointer",
        itemclick: toggleDataSeries
    },
    data: [{
        type: "spline",
        name: "Amount Charged",
        showInLegend: true,
        xValueFormatString: "MMM YYYY",
        yValueFormatString: "#,##0 Rs.",
        dataPoints: [
			{ x: new Date(2015, 7, 1), y: 2700 },
			{ x: new Date(2015, 10, 1), y: 2400 },
			{ x: new Date(2016, 1, 1), y: 10100 },
			{ x: new Date(2016, 4, 1), y: 4500 },
			{ x: new Date(2016, 7, 1), y: 4000 },
			{ x: new Date(2016, 10, 1), y: 4200 },
			{ x: new Date(2017, 1, 1), y: 5900 },
			{ x: new Date(2017, 4, 1), y: 4800 },
			{ x: new Date(2017, 7, 1), y: 6000 },
			{ x: new Date(2017, 10, 1), y: 7200 },
			{ x: new Date(2018, 1, 1), y: 7300 },
			{ x: new Date(2018, 4, 1), y: 8100 }
        ]
    }]
};

window.serviceOptions = serviceOptions;
function toggleDataSeries(e) {
	if (typeof (e.dataSeries.visible) === "undefined" || e.dataSeries.visible) {
		e.dataSeries.visible = false;
	} else {
		e.dataSeries.visible = true;
	}
	e.chart.render();
}
</script>
<script>

var Var_BT_OpenBeneficiaries = document.getElementById("BT_OpenBeneficiaries");
Var_BT_OpenBeneficiaries.addEventListener('click', function () {
    $("#chartContainer").show();
    $("#chartContainer").CanvasJSChart(options);
    $("#serviceContainer").CanvasJSChart(serviceOptions);
});

  function upload_ClaimInvoice() {
      const reader = new FileReader();
      reader.onloadend = function() {
        const ipfs = window.IpfsApi('localhost', 5001) // Connect to IPFS
        const buf = buffer.Buffer(reader.result) // Convert data into buffer
        ipfs.files.add(buf, (err, result) => { // Upload buffer to IPFS
          if(err) {
            console.error(err)
            swal("Error", "Something went wrong!", "error");
            return
          }
          let url = `https://ipfs.io/ipfs/${result[0].hash}`
          console.log(`Url --> ${url}`)
          var claimNumber = document.getElementById("IP_InsuranceClaimNumber").value;
          var claimDate = document.getElementById("IP_InsuranceClaimDate").value;
          var claimAmount = document.getElementById("IP_InsuranceClaimAmount").value;
          var year = parseInt(claimDate.split("-")[0]);
          var month = parseInt(claimDate.split("-")[1]);
          var date = parseInt(claimDate.split("-")[2]);
          console.log(claimDate);
          console.log(claimAmount);
          console.log(claimNumber);
          MultiSigInstance.addClaim("1234",claimNumber,claimAmount,year,month,date, result[0].hash, 2, {to:MultiSigAddress, gas: 300000}, function(err, result){console.log(err);console.log(result);});

          swal("Document Uploaded!", "Thanks for choosing us!", "success");
          // document.getElementById("url").innerHTML= url
          // document.getElementById("url").href= url
          // document.getElementById("output").src = url
        })
      }
      const photo = document.getElementById("IP_ClaimInvoice");
      reader.readAsArrayBuffer(photo.files[0]); // Read Provided File


    }

    function upload_InsuranceIssueInvoice() {
            const reader = new FileReader();
      reader.onloadend = function() {
        const ipfs = window.IpfsApi('localhost', 5001) // Connect to IPFS
        const buf = buffer.Buffer(reader.result) // Convert data into buffer
        ipfs.files.add(buf, (err, result) => { // Upload buffer to IPFS
          if(err) {
            console.error(err)
            swal("Error", "Something went wrong!", "error");
            return
          }
          let url = `https://ipfs.io/ipfs/${result[0].hash}`
          console.log(`Url --> ${url}`)
          var policyNumber = document.getElementById("IP_InsuranceIssueNumber").value;
          var policyDate = document.getElementById("IP_InsuranceIssueDate").value;
          var year = parseInt(policyDate.split("-")[0]);
          var month = parseInt(policyDate.split("-")[1]);
          var date = parseInt(policyDate.split("-")[2]);
          var policyAmount = document.getElementById("IP_InsurancePremiumAmount").value;
          console.log(policyDate);
          console.log(policyAmount);
          console.log(policyNumber);
          MultiSigInstance.addPolicy(policyNumber, policyAmount,year,month,date, 2020,4,5,result[0].hash,{to:MultiSigAddress, gas: 300000}, function(err, result){console.log(err);console.log(result);});
          swal("Document Uploaded!", "Thanks for choosing us!", "success");
          // document.getElementById("url").innerHTML= url
          // document.getElementById("url").href= url
          // document.getElementById("output").src = url
        })
      }
      const photo = document.getElementById("IP_InsuranceIssueInvoice");
      reader.readAsArrayBuffer(photo.files[0]); // Read Provided File
    }

    function upload_CarPurchaseInvoice() {
            const reader = new FileReader();
      reader.onloadend = function() {
        const ipfs = window.IpfsApi('localhost', 5001) // Connect to IPFS
        const buf = buffer.Buffer(reader.result) // Convert data into buffer
        ipfs.files.add(buf, (err, result) => { // Upload buffer to IPFS
          if(err) {
            console.error(err)
            swal("Error", "Something went wrong!", "error");
            return
          }
          let url = `https://ipfs.io/ipfs/${result[0].hash}`
          console.log(`Url --> ${url}`)
          var vinDetails = document.getElementById("IP_CarVIN").value;
          MultiSigInstance.createVehicle(vinDetails,result[0].hash, {to:MultiSigAddress, gas: 200000}, function(err, result){console.log(err);console.log(result);});
          swal("Document Uploaded!", "Thanks for choosing us!", "success");
        })
      }
      const photo = document.getElementById("IP_CarPurchaseInvoice");
      reader.readAsArrayBuffer(photo.files[0]); // Read Provided File
    }

    function upload_ServiceInvoice(argument) {
      // body...  IP_ServiceInvoice
                  const reader = new FileReader();
      reader.onloadend = function() {
        const ipfs = window.IpfsApi('localhost', 5001) // Connect to IPFS
        const buf = buffer.Buffer(reader.result) // Convert data into buffer
        ipfs.files.add(buf, (err, result) => { // Upload buffer to IPFS
          if(err) {
            console.error(err)
            swal("Error", "Something went wrong!", "error");
            return
          }
          let url = `https://ipfs.io/ipfs/${result[0].hash}`
          console.log(`Url --> ${url}`)
          var serviceDate = document.getElementById("IP_ServiceInvoiceDate").value;
          var serviceAmount = document.getElementById("IP_ServiceAmount").value;
          var year = parseInt(serviceDate.split("-")[0]);
          var month = parseInt(serviceDate.split("-")[1]);
          var date = parseInt(serviceDate.split("-")[2]);
          console.log(serviceDate);
          console.log(serviceAmount);
          MultiSigInstance.addVehicleServiceDetails(year, month, date, serviceAmount,result[0].hash, {to:MultiSigAddress, gas: 200000}, function(err, result){console.log(err);console.log(result);});
          swal("Document Uploaded!", "Thanks for choosing us!", "success");
          // document.getElementById("url").innerHTML= url
          // document.getElementById("url").href= url
          // document.getElementById("output").src = url
        })
      }
      const photo = document.getElementById("IP_ServiceInvoice");
      reader.readAsArrayBuffer(photo.files[0]); // Read Provided File
    }

// if (typeof web3 === 'undefined') {
//   $('#metamask').text('Ops, MetaMask is not installed!');
// }

web3js = new Web3(web3.currentProvider);
console.log(web3js);
var MultiSigAddress = "0x108ed6a84dd713d96fdefe90945c87107b7842e8";
var MultiSigContract = web3.eth.contract([ { "anonymous": false, "inputs": [ { "indexed": true, "name": "from", "type": "address" }, { "indexed": true, "name": "to", "type": "address" }, { "indexed": true, "name": "vin", "type": "string" } ], "name": "Transfer", "type": "event" }, { "constant": false, "inputs": [ { "name": "_policyNumber", "type": "string" }, { "name": "_claimNumber", "type": "string" }, { "name": "_amount", "type": "uint256" }, { "name": "y", "type": "uint16" }, { "name": "m", "type": "uint8" }, { "name": "d", "type": "uint8" }, { "name": "hash", "type": "string" }, { "name": "_status", "type": "uint8" } ], "name": "addClaim", "outputs": [], "payable": false, "stateMutability": "nonpayable", "type": "function" }, { "constant": false, "inputs": [ { "name": "_policyNumber", "type": "string" }, { "name": "_premiumAmount", "type": "uint32" }, { "name": "starty", "type": "uint16" }, { "name": "startm", "type": "uint8" }, { "name": "startd", "type": "uint8" }, { "name": "endy", "type": "uint16" }, { "name": "endm", "type": "uint8" }, { "name": "endd", "type": "uint8" }, { "name": "hash", "type": "string" } ], "name": "addPolicy", "outputs": [], "payable": false, "stateMutability": "nonpayable", "type": "function" }, { "constant": false, "inputs": [ { "name": "y", "type": "uint16" }, { "name": "m", "type": "uint8" }, { "name": "d", "type": "uint8" }, { "name": "_invoiceAmount", "type": "uint16" }, { "name": "_invoiceHash", "type": "string" } ], "name": "addVehicleServiceDetails", "outputs": [], "payable": false, "stateMutability": "nonpayable", "type": "function" }, { "constant": false, "inputs": [ { "name": "vin", "type": "string" }, { "name": "hash", "type": "string" } ], "name": "createVehicle", "outputs": [ { "name": "", "type": "bool" } ], "payable": false, "stateMutability": "nonpayable", "type": "function" }, { "anonymous": false, "inputs": [ { "indexed": true, "name": "from", "type": "address" }, { "indexed": true, "name": "vin", "type": "string" } ], "name": "Creation", "type": "event" }, { "constant": false, "inputs": [ { "name": "vin", "type": "string" }, { "name": "owner", "type": "address" }, { "name": "kilometers", "type": "uint256" } ], "name": "transferOwnership", "outputs": [], "payable": false, "stateMutability": "nonpayable", "type": "function" }, { "inputs": [], "payable": false, "stateMutability": "nonpayable", "type": "constructor" }, { "constant": false, "inputs": [ { "name": "vin", "type": "string" }, { "name": "kilometers", "type": "uint256" } ], "name": "updateKilometers", "outputs": [], "payable": false, "stateMutability": "nonpayable", "type": "function" }, { "constant": true, "inputs": [ { "name": "vin", "type": "string" } ], "name": "getCar", "outputs": [ { "name": "owner", "type": "address" }, { "name": "hash", "type": "string" } ], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": true, "inputs": [ { "name": "_claimNo", "type": "string" } ], "name": "getClaim", "outputs": [ { "name": "_policyNumber", "type": "string" }, { "name": "_claimNumber", "type": "string" }, { "name": "_amount", "type": "uint256" }, { "name": "year", "type": "uint16" }, { "name": "month", "type": "uint8" }, { "name": "day", "type": "uint8" }, { "name": "hash", "type": "string" }, { "name": "_status", "type": "uint8" } ], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": true, "inputs": [ { "name": "serviceId", "type": "uint256" } ], "name": "getServicedate", "outputs": [ { "name": "", "type": "uint16" }, { "name": "", "type": "uint8" }, { "name": "", "type": "uint8" } ], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": true, "inputs": [ { "name": "serviceId", "type": "uint256" } ], "name": "getServiceMetaInfo", "outputs": [ { "name": "", "type": "uint16" }, { "name": "", "type": "string" } ], "payable": false, "stateMutability": "view", "type": "function" } ]);
var MultiSigInstance = MultiSigContract.at(MultiSigAddress);
console.log(MultiSigInstance)


</script>
</body>
</html>
